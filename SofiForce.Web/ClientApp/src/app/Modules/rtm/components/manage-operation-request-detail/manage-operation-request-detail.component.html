<div class="row" *ngIf="isLoading">

    <div class="col-md-12">
        <div class="row" style="height: 70vh;">
            <div class="col-12 text-center">
                <app-loader></app-loader>
            </div>
        </div>
    </div>

</div>

<div class="row" *ngIf="!isLoading">
    <div class="col-5">

        <div class="row">

            <div class="col-12">

                <p-panel [showHeader]="false">

                    <div class="row pl-4" *ngIf="!isLoading">
                        <div class="col-12 d-flex align-items-end justify-content-end" *ngIf="model.operationTypeId==1"
                            >
                            <p-splitButton label="Save" appendTo="body" icon="pi pi-check" (onClick)="manage('save')"
                            *ngIf="model.operationStatusId==undefined|| model.operationStatusId==null|| model.operationStatusId==2"  [model]="items"></p-splitButton>
                        </div>
                        <div class="col-12 d-flex align-items-end justify-content-end" *ngIf="model.operationTypeId==2">
                            <p-splitButton label="Save" appendTo="body" icon="pi pi-check" (onClick)="manage('save')"
                            *ngIf="model.operationStatusId==undefined|| model.operationStatusId==null"  [model]="items"></p-splitButton>
                        </div>
                    </div>
                    <div class="row p-fluid p-3">
                        <div class="col-12">
                            <p-timeline [value]="OperationStatuses" layout="horizontal" align="top">
                                <ng-template pTemplate="marker" let-st>
                                    <i class="fa fa-2x fa-check-circle" aria-hidden="true"
                                        *ngIf="st.id<=model.operationStatusId"></i>
                                    <i class="fa fa-2x fa-circle-thin" aria-hidden="true"
                                        *ngIf="st.id > model.operationStatusId"></i>
                                </ng-template>
                                <ng-template pTemplate="content" let-st>
                                    {{st.name}}
                                </ng-template>
                            </p-timeline>
                        </div>



                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'Governerate' | translate}}</label>
                                <p-dropdown [options]="Governerates" [filter]="false" [(ngModel)]="model.governerateId"
                                    [selectId]="model.governerateId" [filterMatchMode]="'contains'"
                                    (onChange)="onGovernerateChange($event)" [editable]="false" [filterBy]="'name'"
                                    [optionLabel]="'name'" [optionValue]="'id'">
                                </p-dropdown>
                            </div>
                        </div>


                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'City' | translate}}</label>
                                <p-dropdown [options]="Cities" [filter]="false" [(ngModel)]="model.cityId"
                                    [selectId]="model.cityId" [filterMatchMode]="'contains'"
                                    (onChange)="onGovernerateChange($event)" [editable]="false" [filterBy]="'name'"
                                    [optionLabel]="'name'" [optionValue]="'id'">
                                </p-dropdown>

                            </div>
                        </div>
                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'Operation Date' | translate}}</label>
                                <p-calendar [disabled]="true" dateFormat="dd/mm/yy" appendTo="body" inputId="time"
                                    [showTime]="true" [showSeconds]="true" [(ngModel)]="model.operationDate">
                                </p-calendar>

                            </div>
                        </div>
                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'Client Type' | translate}}</label>
                                <p-dropdown [options]="ClientTypes" [filter]="false" [(ngModel)]="model.clientTypeId"
                                    [selectId]="model.clientTypeId" [filterMatchMode]="'contains'"
                                    (onChange)="onGovernerateChange($event)" [editable]="false" [filterBy]="'name'"
                                    [optionLabel]="'name'" [optionValue]="'id'">
                                </p-dropdown>

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Name Arabic' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.clientNameEn">

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Name English' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.clientNameEn">

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label style="width: 100%;">{{'Is Chain' | translate}}</label>
                                <p-inputSwitch [(ngModel)]="model.isChain"></p-inputSwitch>

                            </div>
                        </div>

                        <div class="col-6  ">
                            <div class="p-field">
                                <label style="width: 100%;">{{'In Zone' | translate}}</label>
                                <p-inputSwitch [(ngModel)]="model.inZone"></p-inputSwitch>

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Responsible Arabic' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.responsibleNameAr">

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Responsible English' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.responsibleNameEn">

                            </div>
                        </div>

                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Tax Id' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.taxCode">

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Commercial Id' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.commercialCode">

                            </div>
                        </div>
                        <div class="col-12  ">
                            <div class="p-field">
                                <label>{{'Address' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.address">

                            </div>
                        </div>
                        <div class="col-12  ">
                            <div class="p-field">
                                <label>{{'Landmark' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.landmark">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'Building' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.building">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'Floor' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.floor">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'Property' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.property">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'Phone' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.phone">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'Mobile' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.mobile">

                            </div>
                        </div>
                        <div class="col-4  ">
                            <div class="p-field">
                                <label>{{'WhatsApp' | translate}}</label>
                                <input type="text" pInputText [(ngModel)]="model.whatsApp">

                            </div>
                        </div>

                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'lat' | translate}}</label>
                                <button pButton pRipple type="button" icon="pi pi-map-marker"
                                    class="p-button-rounded p-button-secondary p-button-text"></button>


                                <p-inputNumber [(ngModel)]="model.latitude" inputId="minmaxfraction" mode="decimal"
                                    [minFractionDigits]="0" [maxFractionDigits]="10">
                                </p-inputNumber>
                            </div>
                        </div>
                        <div class="col-3  ">
                            <div class="p-field">
                                <label>{{'Lng' | translate}}</label>
                                <button pButton pRipple type="button" icon="pi pi-map-marker"
                                    class="p-button-rounded p-button-secondary p-button-text"></button>



                                <p-inputNumber [(ngModel)]="model.longitude" inputId="minmaxfraction" mode="decimal"
                                    [minFractionDigits]="0" [maxFractionDigits]="10">
                                </p-inputNumber>

                            </div>
                        </div>
                        <div class="col-6  ">
                            <div class="p-field">
                                <label>{{'Location Level' | translate}}</label>
                                <p-dropdown [options]="LocationLevels" [filter]="false"
                                    [(ngModel)]="model.locationLevelId" [selectId]="model.locationLevelId"
                                    [filterMatchMode]="'contains'" [editable]="false" [filterBy]="'name'"
                                    [optionLabel]="'name'" [optionValue]="'id'">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>


                </p-panel>

            </div>


        </div>

    </div>
    <div class="col-7">

        <div class="row p-fluid pt-2">


            <div class="col-6">
                <p-panel [header]="'Preferred Times'|translate" [toggleable]="false">
                    <ng-template pTemplate="icons">
                        <button pButton class="p-panel-header-icon p-link" (click)="managePreferred('add')">
                            <span class="pi pi-plus"></span>
                        </button>
                        <button pButton class="p-panel-header-icon p-link" (click)="managePreferred('delete')"
                            *ngIf="selectedPreferred!=null && selectedPreferred.preferredId>0">
                            <span class="pi pi-times"></span>
                        </button>
                    </ng-template>
                    <div class="row" style="height: 40vh">
                        <div class="col-12">
                            <p-table selectionMode="single" styleClass="p-datatable-gridlines p-datatable-sm"
                                dataKey="preferredId" [(selection)]="selectedPreferred" [value]="model.preferredTimes"
                                [scrollable]="true" scrollHeight="400px">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="min-width:30%">{{'Operation' | translate}}</th>
                                        <th style="min-width:30%">{{'Day' | translate}}</th>
                                        <th style="min-width:20%">{{'from' | translate}}</th>
                                        <th style="min-width:20%">{{'to' | translate}}</th>

                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-row>
                                    <tr [pSelectableRow]="row">
                                        <td style="min-width:30%">{{row.preferredOperationName}}</td>
                                        <td style="min-width:30%">{{row.weekDayName}}</td>
                                        <td style="min-width:20%">{{row.fromTime}}</td>
                                        <td style="min-width:20%">{{row.toTime}}</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </p-panel>
            </div>
            <div class="col-6">
                <p-panel [header]="'Landmarks' |translate" [toggleable]="false">
                    <ng-template pTemplate="icons">
                        <button pButton class="p-panel-header-icon p-link" (click)="manageLandmark('add')">
                            <span class="pi pi-plus"></span>
                        </button>
                        <button pButton class="p-panel-header-icon p-link"
                            *ngIf="selectedLandmark!=null && selectedLandmark.detaillandId>0"
                            (click)="manageLandmark('delete')">
                            <span class="pi pi-times"></span>
                        </button>
                    </ng-template>
                    <div class="row" style="height: 40vh">
                        <div class="col-12">
                            <p-table selectionMode="single" styleClass="p-datatable-gridlines p-datatable-sm"
                                dataKey="detaillandId" [(selection)]="selectedLandmark" [value]="model.landmarks"
                                [scrollable]="true" scrollHeight="400px">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="min-width:100%">{{'Landmark' | translate}}</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-row>
                                    <tr [pSelectableRow]="row">
                                        <td style="min-width:100%">{{row.landmarkName}}</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </p-panel>
            </div>
        </div>

        <div class="row p-fluid pt-2">
            <div class="col-12">
                <p-panel [header]="'Documents'" [toggleable]="false">
                    <ng-template pTemplate="icons">
                        <button pButton class="p-panel-header-icon p-link" (click)="manageDocument('add')">
                            <span class="pi pi-plus"></span>
                        </button>
                    </ng-template>
                    <div class="row" style="height: 20vh">
                        <div class="col-md-2" *ngFor="let item of model.documents">
                            <div class="row">
                                <div class="col-12 d-flex justify-content-center">
                                    <p-image [src]="item.documentPath" alt="Image" height="150px" width="100%"
                                        [preview]="true"></p-image>
                                </div>
                                <div class="col-12">
                                    <p-button [label]="item.documentTypeName" icon="pi pi-times"
                                        (onClick)="selectedDocument=item; manageDocument('delete')"></p-button>
                                </div>
                            </div>

                        </div>
                    </div>
                </p-panel>
            </div>
        </div>

    </div>
</div>


<p-dialog [header]="'Landmarks' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showLandmarks" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">
        <div class="col-12  ">
            <p-dropdown [options]="Landmarks" [filter]="false" [(ngModel)]="selectedLandmark.landmarkId"
                [selectId]="selectedLandmark.landmarkId" [filterMatchMode]="'contains'" [editable]="false"
                [filterBy]="'name'" [optionLabel]="'name'" [optionValue]="'id'">
            </p-dropdown>
        </div>
        <div class="col-12 pt-2 ">

            <button type="button" pButton pRipple [value]="'Select' | translate" icon="pi pi-arrow-down"
                styleClass="p-button-warn" (click)="manageLandmark('save')"></button>
        </div>
    </div>
</p-dialog>


<p-dialog [header]="'Preferred Times' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showPreferreds" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">
        <div class="col-12  ">
            <label>{{'Operation Type' | translate}}</label>
            <p-dropdown [options]="PreferredOperations" [filter]="false" [filterMatchMode]="'contains'"
                [editable]="false" [(ngModel)]="selectedPreferred.preferredOperationId"
                [selectId]="selectedPreferred.preferredOperationId" [filterBy]="'name'" [optionLabel]="'name'"
                [optionValue]="'id'">
            </p-dropdown>
        </div>
        <div class="col-12  ">
            <label>{{'Day of week' | translate}}</label>
            <p-dropdown [options]="WeekDays" [filter]="false" [filterMatchMode]="'contains'" [editable]="false"
                [(ngModel)]="selectedPreferred.weekDayId" [selectId]="selectedPreferred.weekDayId" [filterBy]="'name'"
                [optionLabel]="'name'" [optionValue]="'id'">
            </p-dropdown>
        </div>
        <div class="col-6  ">
            <label>{{'From Time' | translate}}</label>
            <p-calendar [(ngModel)]="fromTime" [timeOnly]="true" [hourFormat]="12" inputId="timeonly">
            </p-calendar>
        </div>
        <div class="col-6  ">
            <label>{{'To Time' | translate}}</label>
            <p-calendar [(ngModel)]="toTime" [timeOnly]="true" [hourFormat]="12" inputId="timeonly">
            </p-calendar>

        </div>

    </div>

    <div class="row pt-2">
        <div class="col-12  ">
            <p-button [label]="'Add to list'" (onClick)="managePreferred('save')"></p-button>

        </div>

    </div>
</p-dialog>

<p-dialog [header]="'Document' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showDocuments" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">
        <div class="col-12  ">
            <label>{{'Document Type' | translate}}</label>
            <p-dropdown [options]="DocumentTypes" [filter]="false" [filterMatchMode]="'contains'" [editable]="false"
                [(ngModel)]="selectedDocument.documentTypeId" [selectId]="selectedDocument.documentTypeId"
                [filterBy]="'name'" [optionLabel]="'name'" [optionValue]="'id'">
            </p-dropdown>
        </div>
        <div class="col-12  ">
            <label>{{'Document' | translate}}</label>
            <p-fileUpload name="files[]" #form url="uploader/add" customUpload="true"
                (uploadHandler)="myUploader($event,form)" [chooseLabel]="'Choose' | translate" accept="image/*"
                [auto]="true" maxFileSize="1000000">
                <ng-template pTemplate="content">

                </ng-template>
            </p-fileUpload>
        </div>

    </div>
</p-dialog>



<p-dialog [header]="'Reject reason' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showReject" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">
        <div class="col-12  ">
            <label>{{'Reject Reason' | translate}}</label>
            <p-dropdown [options]="RejectReasons" [filter]="false" [filterMatchMode]="'contains'" [editable]="false"
                [(ngModel)]="model.operationRejectReasonId" [selectId]="model.operationRejectReasonId"
                [filterBy]="'name'" [optionLabel]="'name'" [optionValue]="'id'">
            </p-dropdown>
        </div>
        <div class="col-12  ">
            <label>{{'Data Accurracy' | translate}}</label>
            <p-rating [(ngModel)]="model.accuracy" [readonly]="false" stars="5" [cancel]="false">
            </p-rating>
        </div>


    </div>

    <div class="row pt-2">
        <div class="col-12  ">
            <p-button [label]="'Reject'" (onClick)="reject()"></p-button>
        </div>

    </div>
</p-dialog>

<p-dialog [header]="'Approve' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showApprove" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">

        <div class="col-12  ">
            <label>{{'Data Accurracy' | translate}}</label>
            <p-rating [(ngModel)]="model.accuracy" [readonly]="false" stars="5" [cancel]="false">
            </p-rating>
        </div>

    </div>

    <div class="row pt-2">

        <div class="col-12  ">
            <p-button [label]="'Approve'" (onClick)="approve()"></p-button>
        </div>

    </div>
</p-dialog>

<p-dialog [header]="'Coded' |translate" [modal]="false" [draggable]="false" [style]="{width: '300px'}"
    [(visible)]="showCoded" position="center" [contentStyle]="{'overflow':'visible'}">


    <div class="row p-fluid">

        <div class="col-12  ">
            <div class="p-field">
                <label>{{'Client' | translate}}</label>
                <div class="p-inputgroup">
                    <input type="text" pInputText [(ngModel)]="model.clientCode" [placeholder]="'Client Code'"
                        [disabled]="true">
                    <button type="button" pButton pRipple icon="pi pi-arrow-up" styleClass="p-button-warn"
                        (click)="Chooser_Client()"></button>
                </div>
            </div>
        </div>

    </div>

    <div class="row pt-2">

        <div class="col-12  ">
            <p-button [label]="'Approve'" (onClick)="coded()"></p-button>
        </div>

    </div>
</p-dialog>